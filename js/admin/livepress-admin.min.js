/*! livepress -v1.0.9
 * http://livepress.com/
 * Copyright (c) 2014 LivePress, Inc.
 */
var Livepress=Livepress||{};Livepress.ensureExists=function(a){return void 0===a&&(a={}),a};var console=console||{log:function(){}};String.prototype.parseGMT=function(a){var b,c,d=this,e=a||"h:i:s a";return b=Date.parse(d.replace(/-/gi,"/"),"Y/m/d H:i:s"),c=new Date(b),"Invalid Date"===c.toString()?this.toString():c=c.format(e)},String.prototype.replaceAll=function(a,b){var c=this;return c=c.split(a).join(b)},"undefined"==typeof window.twttr&&(window.twttr=function(a,b,c){var d,e,f=a.getElementsByTagName(b)[0];if(!a.getElementById(c))return e=a.createElement(b),e.id=c,e.src="https://platform.twitter.com/widgets.js",f.parentNode.insertBefore(e,f),window.twttr||(d={_e:[],ready:function(a){d._e.push(a)}})}(document,"script","twitter-wjs")),jQuery.fn.getBg=function(){var a,b,c,d=jQuery(this);return a=d.css("background-color"),"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a&&void 0!==a?a:(b=this.parents().filter(function(){return c=d.css("background-color"),"transparent"!==c&&"rgba(0, 0, 0, 0)"!==c}).eq(0).css("background-color"),b?d.css("background-color",b):d.css("background-color","#ffffff"),void 0)},jQuery.extend({getUrlVars:function(a){for(var b,c=[],d=a.href||window.location.href,e=d.slice(d.indexOf("?")+1).split("&"),f=0;f<e.length;f++)b=e[f].split("="),c.push(b[0]),c[b[0]]=b[1];return c},getUrlVar:function(a,b){return jQuery.getUrlVars(b||!1)[a]}}),jQuery.fn.outerHTML=function(a){return a?this.before(a).remove():jQuery("<div>").append(this.eq(0).clone()).html()},jQuery.fn.autolink=function(){return this.each(function(){var a=new RegExp('((http|https|ftp)://[\\w?=&./-;#~%-]+(?![\\w\\s?&./;#~%"=-]*>))',"g");jQuery(this).html(jQuery(this).html().replace(a,'<a href="$1">$1</a> '))})},"undefined"==typeof document.activeElement&&jQuery(document).focusin(function(a){document.activeElement=a.target}).focusout(function(){document.activeElement=null}),jQuery.extend(jQuery.expr[":"],{focus:function(a){return a===document.activeElement}}),Date.prototype.format=function(a){var b,c,d="",e=Date.replaceChars;for(b=0;b<a.length;b++)c=a.charAt(b),d+=e[c]?e[c].call(this):c;return d},Date.replaceChars={shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d:function(){return(this.getDate()<10?"0":"")+this.getDate()},D:function(){return Date.replaceChars.shortDays[this.getDay()]},j:function(){return this.getDate()},l:function(){return Date.replaceChars.longDays[this.getDay()]},N:function(){return this.getDay()+1},S:function(){return 1===this.getDate()%10&&11!==this.getDate()?"st":2===this.getDate()%10&&12!==this.getDate()?"nd":3===this.getDate()%10&&13!==this.getDate()?"rd":"th"},w:function(){return this.getDay()},z:function(){return"Not Yet Supported"},W:function(){return"Not Yet Supported"},F:function(){return Date.replaceChars.longMonths[this.getMonth()]},m:function(){return(this.getMonth()<9?"0":"")+(this.getMonth()+1)},M:function(){return Date.replaceChars.shortMonths[this.getMonth()]},n:function(){return this.getMonth()+1},t:function(){return"Not Yet Supported"},L:function(){return 0===this.getFullYear()%4&&0!==this.getFullYear()%100||0===this.getFullYear()%400?"1":"0"},o:function(){return"Not Supported"},Y:function(){return this.getFullYear()},y:function(){return(""+this.getFullYear()).substr(2)},a:function(){return this.getHours()<12?"am":"pm"},A:function(){return this.getHours()<12?"AM":"PM"},B:function(){return"Not Yet Supported"},g:function(){return this.getHours()%12||12},G:function(){return this.getHours()},h:function(){return((this.getHours()%12||12)<10?"0":"")+(this.getHours()%12||12)},H:function(){return(this.getHours()<10?"0":"")+this.getHours()},i:function(){return(this.getMinutes()<10?"0":"")+this.getMinutes()},s:function(){return(this.getSeconds()<10?"0":"")+this.getSeconds()},e:function(){return"Not Yet Supported"},I:function(){return"Not Supported"},O:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+"00"},P:function(){return(-this.getTimezoneOffset()<0?"-":"+")+(Math.abs(this.getTimezoneOffset()/60)<10?"0":"")+Math.abs(this.getTimezoneOffset()/60)+":"+(Math.abs(this.getTimezoneOffset()%60)<10?"0":"")+Math.abs(this.getTimezoneOffset()%60)},T:function(){var a,b;return b=this.getMonth(),this.setMonth(0),a=this.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1"),this.setMonth(b),a},Z:function(){return 60*-this.getTimezoneOffset()},c:function(){return this.format("Y-m-d")+"T"+this.format("H:i:sP")},r:function(){return this.toString()},U:function(){return this.getTime()/1e3}};var ImIntegration={CHECK_TIMEOUT_SECONDS:5,CHECK_TIMES:5};ImIntegration.check_status=function(a){ImIntegration.__check_status(a,ImIntegration.CHECK_TIMES)},ImIntegration.__spin_loading=function(){var a=Livepress.Config.lp_plugin_url+"/img/spin.gif",b=jQuery("<img />").attr("src",a);return console.log("created spin: "+b.html()),console.log("image_path  : "+a),b},ImIntegration.__check_status=function(a,b){var c={},d=jQuery("#check_"+a),e=jQuery("#check_message_"+a),f=Livepress.Config.site_url+"/wp-admin/admin-ajax.php";c.action="im_integration",c.im_integration_check_status=!0,c.im_service=a,console.log("Start status check to: protocol="+a),d.hide(),e.css({color:"black"}).html(ImIntegration.__spin_loading()),jQuery.post(f,c,function(a){var f,g=JSON.parse(a),h=!1,i="";("not_found"===g.status||"offline"===g.status||"failed"===g.status)&&b>0?setTimeout(function(){ImIntegration.__check_status(c.im_service,b-1)},1e3*ImIntegration.CHECK_TIMEOUT_SECONDS):"not_found"===g.status?(h=!0,e.html(lp_strings.account_not_found).css({color:"red"})):"connecting"===g.status?(setTimeout(function(){ImIntegration.__check_status(c.im_service,5)},1e3*ImIntegration.CHECK_TIMEOUT_SECONDS),e.html(lp_strings.connecting).css({color:"lightgreen"})):"offline"===g.status?e.html(lp_strings.offline):"online"===g.status?e.html(lp_strings.connected).css({color:"green"}):"failed"===g.status?(h=!0,f=g.reason,"authentication_error"===f?i=lp_strings.user_pass_invalid:"wrong_jid"===f?i=lp_strings.wrong_account_name:(console.log("Im check failure reason: ",f),i=lp_strings.internal_error),e.html(i).css({color:"red"})):(h=!0,e.html(lp_strings.unknown_error).css({color:"red"})),h&&d.show()})},ImIntegration.test_message_sending=!1,ImIntegration.send_test_message=function(a,b){var c,d,e,f=jQuery("#"+a),g=f.attr("value"),h="",i=this;0!==g.length&&(this.test_message_sending||(this.test_message_sending=!0,f.attr("readOnly",!0),c=jQuery("#"+a+"_test_button"),c.attr("value",lp_strings.sending+"..."),c.attr("disabled",!0),d=jQuery("#"+b+"_message"),d.html(""),e={},e.action="im_integration",e.im_integration_test_message=!0,e.im_service=b,e.buddy=g,console.log("Sending test message to: "+g+" using "+b+" protocol"),jQuery.ajax({url:Livepress.Config.site_url+"/wp-admin/admin-ajax.php",type:"post",dataType:"json",data:e,error:function(){h=lp_strings.problem_connecting},success:function(a){console.log("return from test message: %d",a),h=200===a?lp_strings.test_msg_sent:lp_strings.test_msg_failure},complete:function(){console.log("feed: %s",h),d.html(h),i.test_message_sending=!1,f.attr("readOnly",!1),c.attr("value",lp_strings.send_again),c.attr("disabled",!1)}})))};var OORTLE=OORTLE||{};Livepress.Admin=Livepress.Admin||{},Livepress.Admin.PostStatus=function(){function a(){if(!j){j=!0;var a=jQuery("<div class='lp-spinner'></div>").attr("id","lp_spin_img");jQuery("form#post").before(a)}}function b(a,b){b=b||"lp-notice";var c=jQuery("<p/>").text(a),d=jQuery('<div class="lp-message '+b+'"></div>');d.append(c),jQuery("#post").before(d),setTimeout(function(){d.fadeOut(2e3,function(){jQuery(this).remove()})},1e3*h)}function c(){j=!1,jQuery("#lp_spin_img").remove()}function d(a){b(a,"lp-error")}function e(a){b(a,"lp-warning")}function f(a){"completed"===a?(b("Update was published live to users."),c()):"failed"===a?(e("Update was published NOT live."),c()):"lp_failed"===a?(d("Can't get update status from LivePress."),c()):"empty"===a||"0"===a?c():"-1"===a?(d("Wrong AJAX nonce."),c()):setTimeout(i.check,1e3*g)}var g=4,h=10,i=this,j=!1;i.check=function(){var b=jQuery("#blogging-tool-nonces");a(),jQuery.ajax({url:"admin-ajax.php",data:{livepress_action:!0,_ajax_nonce:b.data("lp-status"),post_id:Livepress.Config.post_id,action:"lp_status"},success:f,error:function(){d("Can't get update status from blog server."),c()}})},jQuery(window).on("livepress.post_update",function(){a(),setTimeout(i.check,1e3*g)})},Livepress.Admin.PostToTwitter=function(){function a(a){try{g.close()}catch(b){}g=window.open(a,"_blank","height=600,width=600"),jQuery("#post_to_twitter_url").html('<br /><a href="'+a+'">'+a+"</a>").click(function(){try{g.close()}catch(b){}return g=void 0,g=window.open(a,"_blank","height=600,width=600"),!1}).show()}function b(a){var c=jQuery("#"+i),e=a||1,h={action:"check_oauth_authorization_status"};c.html(lp_strings.checking_auth+"... ("+e+")"),jQuery.ajax({url:"./admin-ajax.php",data:h,type:"post",async:!0,error:function(){c.html(lp_strings.failed_to_check)},success:function(a){if("authorized"===a.status)c.html(lp_strings.sending_twitter+": <strong>"+a.username+"</strong>."),jQuery("#lp-post-to-twitter-change_link").show(),jQuery("#lp-post-to-twitter-change").hide();else if("unauthorized"===a.status)d();else if("not_available"===a.status){var h=!1;if(void 0!==g)try{h=g.closed}catch(i){if("ReferenceError"!==i.name.toString())throw i;h=!0}void 0!==g&&h?d():(c.html(lp_strings.status_not_avail),f=setTimeout(function(){b(++e)},1e3*j))}else c.html(lp_strings.internal_error)}})}function c(c,d){var e,g;return h?!1:(h=!0,e=jQuery("#"+i),g={},g.action="post_to_twitter",g.enable=document.getElementById("lp-remote").checked,c&&(g.change_oauth_user=!0),jQuery("#post_to_twitter_message_change_link").hide(),jQuery("#post_to_twitter_url").hide(),jQuery.ajax({url:"./admin-ajax.php",data:g,type:"post",async:!0,error:function(a){409===a.status?e.html("Already "+(g.enable?"enabled.":"disabled.")):502===a.status?"404"===a.responseText?e.html(lp_strings.noconnect_twitter):e.html(lp_strings.noconnect_livepress):e.html(lp_strings.failed_unknown+" ("+lp_strings.return_code+": "+a.status+")"),clearTimeout(f)},success:function(c){g.enable?(console.log("OAuth url: ",c),e.html(lp_strings.new_twitter_window),a(c),f=setTimeout(b,1e3*j)):(clearTimeout(f),d!==!0&&e.html(""))},complete:function(){h=!1}}),!0)}function d(){var a=jQuery("#"+i);a.html(lp_strings.twitter_unauthorized),c(!1,!0)}function e(a,b){a.preventDefault(),a.stopPropagation(),c(b)}var f,g,h=!1,i="post_to_twitter_message",j=5;jQuery("#post_to_twitter").on("click",function(a){e(a,!1)}),jQuery("#lp-post-to-twitter-change, #lp-post-to-twitter-change_link").on("click",function(a){e(a,!0)}),jQuery("#lp-post-to-twitter-not-authorized").on("click",function(){return jQuery("#"+i).html(lp_strings.new_twitter_window),a(this.href),f=window.setTimeout(b,1e3*j),!1})},Livepress.Admin.Tools=function(){function a(){jQuery.ajax({url:Livepress.Config.ajax_url,data:{action:"get_blogging_tools",post_id:Livepress.Config.post_id},type:"post",success:function(a){e.innerHTML=a,jQuery(".blogging-tools-tabs").on("click","a",function(a){var b,c=jQuery(this);return a.preventDefault(),c.is(".active a")?!1:(jQuery(".blogging-tools-tabs .active").removeClass("active"),c.parent("li").addClass("active"),b=jQuery(c.attr("href")),jQuery(".blogging-tools-content").not(b).removeClass("active").hide(),b.addClass("active").show(),!1)}),b()}})}function b(){function a(){var a,b;return a=jQuery.ajax({url:Livepress.Config.ajax_url,data:{action:"update-live-status",post_id:Livepress.Config.post_id,ajax_nonce:c.data("live-status")},type:"post",success:function(){jQuery("#livepress_status_meta_box").toggleClass("live").toggleClass("not-live"),d.Dashboard.Helpers.setupLivePressTabs()}}),b=jQuery.ajax({url:Livepress.Config.ajax_url,data:{action:"update-live-comments",post_id:Livepress.Config.post_id},type:"post",dataType:"json",success:function(a){OORTLE.Livepress.LivepressHUD.init(),Collaboration.Edit.initialize(a)}}),jQuery.when(a,b)}var b,c=jQuery("#blogging-tool-nonces"),d=this;jQuery("#tab-panel-live-notes").on("click",'input[type="submit"]',function(a){var b=jQuery(this),d=jQuery(".live-notes-status");a.preventDefault(),b.attr("disabled","disabled"),jQuery.ajax({url:Livepress.Config.ajax_url,data:{action:"update-live-notes",post_id:Livepress.Config.post_id,content:jQuery("#live-notes-text").val(),ajax_nonce:c.data("live-notes")},type:"post",success:function(){b.removeAttr("disabled"),d.show(),setTimeout(function(){d.addClass("hide-fade"),setTimeout(function(){d.hide().removeClass("hide-fade")},3e3)},2e3)}})}),jQuery("#lp-pub-status-bar").on("click","a.toggle-live",function(d){d.preventDefault(),jQuery("#livepress_status_meta_box").hasClass("live")?confirm(lp_strings.confirm_switch)&&(Dashboard.Twitter.removeAllTerms(),Dashboard.Twitter.removeAllTweets(),b=a(),jQuery.when(b).done(function(){jQuery("form#post").attr("action",jQuery("form#post").attr("action")+"?post="+Livepress.Config.post_id+"&action=edit"+"&merge_action=merge_children&merge_noonce="+c.data("merge-post")).submit()})):(b=a(),jQuery.when(b).done(function(){setTimeout(function(){jQuery("#publish").removeAttr("disabled").click()},50)}))})}var c=document.createElement("div");c.className="hide-if-no-js screen-meta-toggle",c.setAttribute("id","blogging-tools-link-wrap");var d=document.createElement("a");d.className="show-settings",d.setAttribute("id","blogging-tools-link"),d.setAttribute("href","#blogging-tools-wrap");var e=document.createElement("div");e.className="hidden",e.setAttribute("id","blogging-tools-wrap");var f=jQuery(c),g=jQuery(e);this.render=function(){var b=document.getElementById("blogging-tools-link-wrap");null!==b&&b.parentNode.removeChild(b),b=document.getElementById("blogging-tools-link"),null!==b&&b.parentNode.removeChild(b),b=document.getElementById("blogging-tools-wrap"),null!==b&&b.parentNode.removeChild(b),f.append(d),jQuery(d).text("Live Blogging Tools"),f.insertAfter("#screen-options-link-wrap"),g.insertAfter("#screen-options-wrap"),a(),jQuery(window).trigger("livepress.blogging-tools-loaded")}},jQuery(function(){var a=new Livepress.Admin.PostStatus;if(new Livepress.Admin.PostToTwitter,a.check(),jQuery.fn.animateTo=function(a){var b,c,d=1,e=jQuery(this),f=parseInt(e.text(),10);f!==a&&(f>a&&(d=-1*d),c=function(){return function(){f+=d,e.text(f),f===a&&clearInterval(b)}}(),b=setInterval(c,50))},void 0===OORTLE.Livepress&&void 0!==window.tinymce&&(OORTLE.Livepress=function(){function a(a){return v('<link rel="stylesheet" type="text/css" href="'+r+"css/"+a+".css"+"?"+ +new Date+'" />')}function b(){var a,b;return this.hide=function(){a.slideUp("fast")},this.show=function(){a.slideDown("fast")},this.init=function(){a=v(".inner-lp-dashboard"),b=v("#livepress-updates_num"),this.show()},this.updateReaders=function(a){var b=1===a?lp_strings.persons_online:lp_strings.people_online,c=v("#livepress-online_num");return c.siblings(".label").text(b),c.text(a)},this.updateLivePosts=function(a){return 0===b.length&&(b=v("#livepress-updates_num")),b.text(a)},this.updateComments=function(a){var b=1===a?lp_strings.comment:lp_strings.comments,c=v("#livepress-comments_num");return c.siblings(".label").text(b),c.text(a)},this.sumToComments=function(a){var b=v("#livepress-comments_num"),c=parseInt(b.text(),10),d=c+a,e=1===d?lp_strings.comment:lp_strings.comments;b.siblings(".label").text(e),b.text(d)},this}function c(){var a=this,b=jQuery("#livepress-nonces"),c=new RegExp("\\[livepress_metainfo[^\\]]*]"),d=new RegExp("^\\s*\\[livepress_metainfo[^\\]]*]\\s*$");a.ajaxAction=function(a,b,c,d){return jQuery.ajax({type:"POST",url:Livepress.Config.site_url+"/wp-admin/admin-ajax.php",data:jQuery.extend({action:a,content:b,post_id:Livepress.Config.post_id},d||{}),dataType:"json",success:c,error:function(a,b,d){c.apply(a,[void 0,b,d])}})},a.doStartEE=function(b,c){return a.ajaxAction("start_ee",b,c)},a.appendPostUpdate=function(c,d,e){var f=void 0===e?{}:{title:e};return f._ajax_nonce=b.data("append-nonce"),jQuery(".peeklink span, .peekmessage").removeClass("hidden"),jQuery(".peek").addClass("live"),jQuery(window).trigger("livepress.post_update"),a.ajaxAction("append_post_update",c,d,f)},a.changePostUpdate=function(c,d,e){var f=b.data("change-nonce");return a.ajaxAction("change_post_update",d,e,{update_id:c,_ajax_nonce:f})},a.deletePostUpdate=function(c,d){var e=b.data("delete-nonce");return a.ajaxAction("delete_post_update","",d,{update_id:c,_ajax_nonce:e})},a.getProcessedContent=function(b){if(void 0!==b){var c=b.getContent({format:"raw"});if(c=c.replace('<p><br data-mce-bogus="1"></p>',""),""!==c.trim()||(b.undoManager.redo(),c=b.getContent({format:"raw"}).replace('<p><br data-mce-bogus="1"></p>',""),""!==c.trim())){var d=switchEditors.pre_wpautop(c);return jQuery('.livepress-author-info input[type="checkbox"]').is(":checked")&&jQuery(b.formElement.outerHTML).hasClass("livepress-newform")&&(d=a.newMetainfoShortcode(!0)+d),d}}},a.newMetainfoShortcode=function(a){var b,c,d,e="[livepress_metainfo";return a=a||!1,s.author_display_name&&(e+=' author="'+s.author_display_name+'"'),b=new Date,c=b.getTime()+6e4*b.getTimezoneOffset(),d=c+36e5*Livepress.Config.blog_gmt_offset,d=new Date(d),s.timestamp_template&&(window.eeActive?(e+=' time="'+d.format(s.timestamp_template)+'"',e+=' timestamp="'+b.toISOString()+'"'):e+=" POSTTIME "),s.has_avatar&&(e+=' has_avatar="1"'),e+="]",a||(e+="\n"),e},a.hasMetainfoShortcode=function(a){return c.test(a)},a.hasMetainfoShortcodeOnly=function(a){return d.test(a)}}function d(a,b){var c=this;if(c.handle=o+"-tiny"+ +new Date,c.mode=a,"new"===c.mode)c.originalContent="",void 0!==tinyMCE.onRemoveEditor&&("3"===tinymce.majorVersion?tinyMCE.onRemoveEditor.add(function(a,b){if(b!==c&&tinyMCE.editors.hasOwnProperty(c.handle))try{tinyMCE.execCommand("mceFocus",!1,c.handle)}catch(d){console.log("mceFocus error",d)}return!0}):tinyMCE.on("RemoveEditor",function(a,b){if(b!==c&&tinyMCE.editors.hasOwnProperty(c.handle))try{tinyMCE.execCommand("mceFocus",!1,c.handle),tinyMCE.focus()}catch(d){console.log("mceFocus error",d)}return!0}));else if("editing"===c.mode||"deleting"===c.mode){var d=v(b);c.originalHtmlContent=d.data("originalHtmlContent")||d,c.originalContent=d.data("originalContent")||d.data("nonExpandedContent")||"",c.originalId=d.data("originalId"),c.originalUpdateId=d.attr("id"),c.newEditContent="deleting"===c.mode?null:d.data("nonExpandedContent")}return c.newEditContent=c.newEditContent?switchEditors.wpautop(c.newEditContent):c.newEditContent,c.formLayout=c.formLayout.replace("{content}",c.newEditContent||c.originalContent||""),c.formLayout=c.formLayout.replace("{handle}",c.handle),c.$form=v(c.formLayout).find("div.livepress-form-actions:first").on("click",function(a){c.onFormAction(a)}).end().on("submit",function(){return c.onSave(),!1}),c.$form.attr("id",c.originalUpdateId),c.$form.data("originalId",c.originalId),c.$form.addClass("livepress-update-form"),"new"===a?(c.$form.find("input.button:not(.primary)").remove(),c.$form.find("a.livepress-delete").remove(),c.$form.addClass(o+"-newform"),c.$form.find("input.button-primary").attr("disabled","disabled"),"publish"!==v("#post input[name=original_post_status]").val()?(c.$form.find("input.published").remove(),c.$form.find(".quick-publish").remove()):c.$form.find("input.notpublished").remove()):(c.$form.find(".primary.button-primary").remove(),c.$form.find(".livepress-author-info").remove(),"deleting"===a&&c.$form.addClass(o+"-delform")),this}var e,f,g,h,i,j,k,l,m,n,o="livepress",p=tinyMCE.i18n,q="en.livepress.",r=Livepress.Config.lp_plugin_url+"tinymce/",s=(tinyMCE.baseURI.directory,Livepress.Config.PostMetainfo),t=!1,u=s.placement_of_updates,v=jQuery,w=(document.getElementById,tinymce.extend),x=tinymce.each;return window.eeActive=!1,x({start:lp_strings.start_live,stop:lp_strings.stop_live,readers:lp_strings.readers_online,updates:lp_strings.lp_updates_posted,comments:lp_strings.comments,toggle:lp_strings.click_to_toggle,title:lp_strings.real_time_editor,toggleOff:lp_strings.off,toggleOn:lp_strings.on,toggleChat:lp_strings.private_chat},function(a,b){p[q+b]=a}),jQuery(window).on("start.livechat",function(){t?console.log("already loaded chat before"):(t=!0,v('<link rel="stylesheet" type="text/css" href="'+Livepress.Config.lp_plugin_url+"css/collaboration.css"+"?"+ +new Date+'" />').appendTo("head"),jQuery.fn.dialog||v.getScript(r+"jquery.ui.js",function(){a("flick/jquery-ui-1.7.2.custom").appendTo("head")}))}),a("outside").appendTo("head"),n=function(){if("undefined"==typeof window.twttr&&(window.twttr=function(a,b,c){var d,e,f=a.getElementsByTagName(b)[0];if(!a.getElementById(c))return e=a.createElement(b),e.id=c,e.src="https://platform.twitter.com/widgets.js",f.parentNode.insertBefore(e,f),window.twttr||(d={_e:[],ready:function(a){d._e.push(a)}})}(document,"script","twitter-wjs")),!l){l=!0;var a=tinyMCE.activeEditor;a?(h=v(tinyMCE.activeEditor.getDoc()),i=h.find("html:first"),j=h.find("head:first"),k=h.find("body:first")):h=i=j=null,void 0!==Livepress.Config.debug&&Livepress.Config.debug&&(v(document).find("html:first").addClass("debug"),null!=h&&h.find("html:first").addClass("debug"))}OORTLE.Livepress.LivepressHUD.show(),setTimeout(e.init,1),v(document.body).add(i).addClass(o+"-active")},jQuery(window).on("start.livepress",function(){window.eeActive=!0,tinyMCE.editors.content||switchEditors.go("content","tmce"),setTimeout(n,5)}),jQuery(window).on("stop.livepress",function(){window.eeActive=!1,OORTLE.Livepress.LivepressHUD.hide(),Collaboration.Edit.destroy(),v(document.body).add(i).removeClass(o+"-active"),e.hide()}),m=new c,w(d.prototype,{mode:null,formLayout:["<form>",'<div class="editorcontainer">','<textarea id="{handle}">{content}</textarea>',"</div>",'<div class="editorcontainerend"></div>','<div class="livepress-form-actions">','<div class="livepress-author-info"><input type="checkbox" checked="checked" /> '+lp_strings.include_timestamp+"</div>",'<a href="#" class="livepress-delete" data-action="delete">'+lp_strings.delete_perm+"</a>",'<span class="quick-publish">'+lp_strings.ctrl_enter+"</span>",'<input class="livepress-cancel button button-secondary" type="button" value="'+lp_strings.cancel+'" data-action="cancel" />','<input class="livepress-update button button-primary" type="submit" value="'+lp_strings.save+'" data-action="update" />','<input class="livepress-submit published primary button-primary" type="submit" value="'+lp_strings.push_update+'" data-action="update" />','<input class="livepress-submit notpublished primary button-primary" type="submit" value="'+lp_strings.add_update+'" data-action="update" />',"</div>",'<div class="clear"></div>',"</form>"].join(""),enableTiny:function(a){var b,c=this,d="3"===tinymce.majorVersion?"mceAddControl":"mceAddEditor",e=jQuery(".livepress-newform").find("input.button-primary");return tinyMCE.execCommand(d,!1,this.handle),(b=tinyMCE.editors[this.handle])?(b.dom.loadCSS(r+"css/inside.css"+"?"+ +new Date),b.dom.addClass(b.dom.getRoot(),"livepress_editor"),a&&(b.dom.addClass(b.dom.getRoot(),"livepress-"+a+"_editor"),b.dom.addClass(b.dom.getRoot().parentNode,"livepress-"+a+"_editor")),s.has_avatar&&b.dom.addClass(b.dom.getRoot(),"livepress-has-avatar"),"3"===tinymce.majorVersion?(b.onKeyDown.add(function(a,b){b.ctrlKey&&13===b.keyCode&&(b.preventDefault(),a.undoManager.undo(),c.onSave())}),b.onKeyUp.add(function(a){""!==a.getContent().trim()?e.removeAttr("disabled"):e.attr("disabled","disabled")})):(b.on("KeyDown",function(a){a.ctrlKey&&13===a.keyCode&&(a.preventDefault(),c.onSave())}),b.on("KeyUp",function(){""!==this.getContent().trim()?e.removeAttr("disabled"):e.attr("disabled","disabled")})),void 0):(console.log("Unable to get editor for "+this.handle),void 0)},disableTiny:function(){tinyMCE.execCommand("mceRemoveControl",!1,this.handle)},stash:function(){this.disableTiny(),this.$form.remove()},syncData:function(){},mergeData:function(a){var b,c,d,e,g,h=[],i={},j={},k=f.find("div.inside:first");for(k.children().each(function(){var a=v(this),b=a.data("nonExpandedContent"),c=a.data("originalId");i[c]=h.length,h[h.length]={id:c,cnt:b,handle:a}}),b=0;b<a.length;b++)j[a[b].id]=b;for(b=0,c=0;b<a.length&&c<h.length;)if(a[b].id===h[c].id)b++,c++;else if(a[b].id in i){for(d=i[a[b].id];d>c;c++)h[c].handle.remove(),h[c].handle=void 0;b++,c++}else e=a[b],g=v(e.prefix+e.proceed+e.suffix),g.data("nonExpandedContent",e.content),g.data("originalContent",e.orig),g.data("originalHtmlContent",e.origproc),g.data("originalId",e.id),g.attr("editStyle",""),g.insertBefore(h[c].handle),b++;for(;c<h.length;c++)h[c].handle.remove();for(;b<a.length;b++)e=a[b],g=v(e.prefix+e.proceed+e.suffix),g.data("nonExpandedContent",e.content),g.data("originalContent",e.orig),g.data("originalHtmlContent",e.origproc),g.data("originalId",e.id),g.attr("editStyle",""),k.append(g);Collaboration.Edit.update_live_posts_number()},onFormAction:function(a){var b=a.target.getAttribute("data-action");return"cancel"===b?(this.onCancel(),!1):"delete"===b?(a.preventDefault(),this.onDelete(),!1):void 0},displayContent:function(a){var b=v(this.originalHtmlContent);return b.data("nonExpandedContent",this.originalContent),b.data("originalContent",""),b.attr("editStyle",""),window.twttr.widgets.load(b[0]),b.insertAfter(a),a.remove(),this.addListeners(b),f.data("mode",""),!1},onSave:function(){var a=jQuery("#lp-pub-status-bar");a.hasClass("no-toggle")||(a.removeClass("not-live").addClass("live"),a.find("a.toggle-live span").removeClass("hidden"),a.find(".icon").addClass("live").removeClass("not-live"),a.find(".first-line").find(".lp-on").removeClass("hidden"),a.find(".first-line").find(".lp-off").addClass("hidden"),a.find(".second-line").find(".inactive").addClass("hidden"),a.find(".recent").removeClass("hidden"));var b=m.getProcessedContent(tinyMCE.editors[this.handle]),c=v("<div>").append(b).contents().filter(function(){return 3===this.nodeType||""!==this.innerHtml||""!==this.innerText}).length>0,d=m.hasMetainfoShortcodeOnly(b);if(!c&&""===v(b).text().trim()||d){if("new"===this.mode){var e=function(){return!1};return m.appendPostUpdate("",e,v("#title").val()),!1}return this.onDelete()}var g=v("<div class='lp-spinner'></div>"),h=g,i=function(a){return function(b){a.originalHtmlContent=b.prefix+b.proceed+b.suffix,a.originalContent=b.content,a.originalId=b.id,a.displayContent(h),Collaboration.Edit.update_live_posts_number()}}(this);if("new"===this.mode){var j="bottom"===u?"appendTo":"prependTo";g[j](f.find("div.inside:first")),tinyMCE.editors[this.handle].setContent(""),m.appendPostUpdate(b,i,v("#title").val())}else tinyMCE.execCommand("mceRemoveControl",!1,this.handle),g.insertAfter(this.$form),g.data("nonExpandedContent",b),this.$form.remove(),m.changePostUpdate(this.originalUpdateId,b,i);return!1},onCancel:function(){console.log("onCancel()");var a=m.getProcessedContent(tinyMCE.editors[this.handle]),b=!0;return"deleting"!==this.mode&&a!==this.originalContent&&(console.log([a,this.originalContent]),b=confirm(lp_strings.confirm_cancel)),b&&(tinyMCE.execCommand("mceRemoveControl",!1,this.handle),this.displayContent(this.$form)),!1},onDelete:function(){var a=confirm(lp_strings.confirm_delete);if(a){tinyMCE.execCommand("mceRemoveControl",!1,this.handle);var b=v("<div class='lp-spinner'></div>");b.insertAfter(this.$form),this.$form.remove(),m.deletePostUpdate(this.originalUpdateId,function(){b.remove(),Collaboration.Edit.update_live_posts_number()})}return!1},addListeners:function(a){a.hover(e.onUpdateHoverIn,e.onUpdateHoverOut),a.find("div").not(".livepress-meta").find("a").on("click",function(a){a.stopPropagation(),a.preventDefault()})}}),e=function(){var a=0,b=null;f=v(['<div id="livepress-canvas" class="">','<h3><span id="livepress-updates_num">-</span> '+lp_strings.updates+"</h3>","<div class='inside'></div>","</div>"].join(""));var c=function(){return"editing"===f.data("mode")},h=function(){c()||v(this).addClass("hover")},i=function(a){console.log("Show micro post form"),g=new d("new",a),f.before(g.$form),g.enableTiny("main"),tinyMCE.editors.originalContent||(tinyMCE.editors.originalContent=tinyMCE.editors.content,tinyMCE.editors.content=tinyMCE.editors[g.handle])},j=function(a){if(console.log("addPost(data)"),""===a.replace(/<p>\s*<\/p>/gi,""))return!1;var b=v(a),c="bottom"===Livepress.Config.PostMetainfo.placement_of_updates?"appendTo":"prependTo";return b.hide()[c](f.find("div.inside:first")).animate({height:"toggle",opacity:"toggle"},"slow",function(){v(this).removeAttr("style")}),!1},k=function(){g&&g.stash(),tinyMCE.editors.content=tinyMCE.editors.originalContent,delete tinyMCE.editors.originalContent},l=function(){if(b){var a=b;a.abort(),b=null}else v("#post-body-content .livepress-newform,.secondary-editor-tools").hide(),g.syncData(),k(),f.hide(),v("#postdivrich").show()},n=function(a){void 0!==g&&g.mergeData(a)},o=function(){c()||v(this).removeClass("hover")},p=function(){return c()&&!confirm(lp_strings.discard_unsaved)?!1:(l(),!1)},q=function(){var g=document.getElementById("postdivrich"),j=jQuery(g);if(window.eeActive){if(!tinyMCE.editors.length||void 0===tinyMCE.editors.content||!tinyMCE.editors.content.initialized)return window.setTimeout(q,50),void 0;a||v.fn.live||(v.fn.live=v.fn.livequery,v(document.getElementById("live-blog-disable")).on("click",p)),j.hide();var k=document.createElement("div"),l=jQuery(k),n=document.createElement("div");n.className="lp-spinner",n.setAttribute("id","lp_spin_livecanvas"),k.appendChild(n);var r=document.createElement("p");r.style.textAlign="center",r.innerText=lp_strings.loading_content+"...",k.appendChild(r);var s=document.getElementById("titlediv");s.nextSibling?s.parentNode.insertBefore(k,s.nextSibling):s.parentNode.appendChild(k);var t=m.getProcessedContent(tinyMCE.editors.content),u=function(a){var b=a.orig,c=a.user;if(b||(b=[]),!c)return{prepend:[],append:[],changed:[],deleted:[],regions:b};var d,e=[],f=[],g=[],h=[],i=[],j=0,k=0,l=0;for(j=0;j<b.length&&!l;j++){var m=b[j].id;for(k=0;k<c.length&&!l;k++)if(m===c[k].id){if(l=1,0===j&&0===k)l=1;else if(0===j&&1===k)e[e.length]=c[0].id,c[0].orig="",c[0].origproc="",i[i.length]=c[0];else if(1===j&&1===k)e[e.length]=c[0].id,h[h.length]=b[0].id,c[0].orig="",c[0].origproc="",i[i.length]=c[0],b[0].orig=b[0].content,b[0].origproc=b[0].prefix+b[0].proceed+b[0].suffix,b[0].content="",i[i.length]=b[0];else{for(d=0;j>d;d++)h[h.length]=b[d].id,b[d].orig=b[d].content,b[d].proc=b[d].prefix+b[d].proceed+b[d].suffix,b[d].content="",i[i.length]=b[d];for(d=0;k>d;d++)e[e.length]=c[d].id,c[d].orig="",c[d].origproc="",i[i.length]=c[d]}j--,k--}}for(;j<b.length&&k<c.length;){if(b[j].id!==c[k].id){var n,o,p=0;for(n=j;n<b.length&&!p;n++){var q=b[n].id;for(o=k;o<c.length&&!p;o++)if(c[o].id===q){for(p=k;o>p;p++)g[g.length]=c[p].id,c[p].orig="",c[p].origproc="",i[i.length]=c[p];for(p=j;n>p;p++)h[h.length]=b[p].id,b[p].orig=b[p].content,b[p].origproc=b[p].prefix+b[p].proceed+b[p].suffix,b[p].content="",i[i.length]=b[p];p=1}}if(!p)break;j=n-1,k=o-1}b[j].content!==c[k].content&&(g[g.length]=b[j].id),c[k].orig=b[j].content,c[k].origproc=b[j].prefix+b[j].proceed+b[j].suffix,i[i.length]=c[k],j++,k++}for(;k<c.length;k++)f[f.length]=c[k].id,c[k].orig="",c[k].origproc="",i[i.length]=c[k];for(;j<b.length;j++)h[h.length]=b[j].id,b[j].orig=b[j].content,b[j].origproc=b[j].prefix+b[j].proceed+b[j].suffix,b[j].content="",i[i.length]=b[j];return{prepend:e,append:f,changed:g,deleted:h,regions:i}},w=function(){v("#post-body-content .livepress-newform,.secondary-editor-tools").hide(),f.hide(),j.show(),l.remove(),Collaboration.Edit.destroy();var a=jQuery("#live-switcher");a.hasClass("on")&&a.trigger("click")},x=function(g,j,k){if(this===b||k===b){var m=0;
if(void 0===g)return w("Error: "+j+" : "+k);g.edit_uuid&&(Livepress.Config.post_edit_msg_id=g.edit_uuid),"editStartup"in g?Collaboration.Edit.initialize(g.editStartup):Collaboration.Edit.initialize();var n=u(g),p=f.find("div.inside:first").html(""),q=0,r=0,s=0,t=0,x="",y="";for(m=0;m<n.regions.length;m++){var z=n.regions[m];if(q<n.prepend.length&&z.id===n.prepend[q]){if(!q&&!r){y=z.content,q++;continue}x="new"}else if(r<n.append.length&&z.id===n.append[r]){if(!q&&!r){y=z.content,r++;continue}x="new"}else s<n.changed.length&&z.id===n.changed[s]?(x="edit",s++):t<n.deleted.length&&z.id===n.deleted[t]?(x="del",t++):x="";var A=z.prefix+z.proceed+z.suffix,B=void 0===z.origproc?A:z.origproc,C=v(A),D=void 0===z.orig?z.content:z.orig;if(C.data("nonExpandedContent",z.content),C.data("originalContent",D),C.data("originalHtmlContent",B),C.data("originalId",z.id),"new"===x)return w(lp_strings.double_added);C.attr("editStyle",x);try{window.twttr.widgets.load(C[0])}catch(E){}p.append(C)}if(p.find("div.livepress-update").hover(h,o),l.remove(),a)v("#post-body-content .livepress-newform").show(),f.show();else{f.insertAfter("#titlediv");var F=document.getElementById("livepress-canvas"),G=v(F);G.on("click","div.livepress-update",function(a){var b=v(a.target);if(b.is("a,input,button,textarea")||b.parents("a,input,button,textarea").length>0)return!0;if(!c()){var e=this.getAttribute("editStyle"),f=new d("del"===e?"deleting":"editing",this);f.$form.insertAfter(this),f.enableTiny(e),jQuery(this).remove()}}),G.on("click","div.livepress-update a",function(a){a.stopPropagation()})}var H=v(".secondary-editor-tools");H.length?H.show():jQuery("#wp-content-editor-tools").clone(!0).insertAfter("#titlediv").addClass("secondary-editor-tools").find("#content-tmce, #content-html").each(function(){jQuery(this).removeAttr("id").removeAttr("onclick").on("click",function(){})}),i(y),Collaboration.Edit.update_live_posts_number();var I=f.find("div.livepress-update:first");jQuery("#livepress_status_meta_box").hasClass("pinned-header")&&(I.wrap('<div class="pinned-first-livepress-update"></div>').before('<div class="pinned-first-livepress-update-header"><div class="dashicons dashicons-arrow-down"></div>'+lp_strings.live_post_header+"</div>"),f.find(".pinned-first-livepress-update").prependTo(f).find(".livepress-update:first").find(".livepress-delete").hide(),f.find(".pinned-first-livepress-update div.livepress-update").hide(),f.on("click",".pinned-first-livepress-update-header",function(){var a=f.find(".pinned-first-livepress-update div.livepress-update"),b=f.find(".dashicons");a.is(":visible")?(a.slideUp("fast"),b.removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down")):(a.slideDown("fast"),b.removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up"))}));var J=jQuery("#publish");J.on("click",function(){return e.hide(),!0}),a=1,b=null}};b=m.doStartEE(t,x)}},r=function(){return f.find("div.inside:first")};return{init:q,get:r,hide:l,mergeData:n,onUpdateHoverIn:h,onUpdateHoverOut:o,showMicroPostForm:i,hideMicroPostForm:k,addPost:j}}(),Livepress.Ready=function(){OORTLE.Livepress.Dashboard=new Dashboard.Controller,OORTLE.Livepress.LivepressHUD.init(),jQuery(".metabox-prefs label[for=livepress_status_meta_box-hide]").hide()},{LivepressHUD:new b,startLiveCanvas:e.init,getLiveCanvas:e.get,mergeLiveCanvasData:e.mergeData}}()),function(){function a(a){a=a||window.event;for(var h,i,j,k=a.target||a.srcElement;k&&"a"!==k.nodeName.toLowerCase();)k=k.parentNode;console.log("handle intent"),k&&"a"===k.nodeName.toLowerCase()&&k.href&&(h=k.href.match(b),h&&(i=Math.round(g/2-d/2),j=0,f>e&&(j=Math.round(f/2-e/2)),window.open(k.href,"intent",c+",width="+d+",height="+e+",left="+i+",top="+j),a.returnValue=!1,a.preventDefault&&a.preventDefault()))}if(!window.__twitterIntentHandler){var b=/twitter\.com(\:\d{2,4})?\/intent\/(\w+)/,c="scrollbars=yes,resizable=yes,toolbar=no,location=yes",d=550,e=420,f=screen.height,g=screen.width;document.addEventListener?document.addEventListener("click",a,!1):document.attachEvent&&document.attachEvent("onclick",a),window.__twitterIntentHandler=!0}}(),void 0!==Livepress.Config.current_screen&&"post"===Livepress.Config.current_screen[0]&&"post"===Livepress.Config.current_screen[1]){var b=new Livepress.Admin.Tools;b.render()}});